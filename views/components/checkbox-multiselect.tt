[%# 
    A psuedo-multiselect using a group of checkboxes. It is more accessible to screenreaders and easier
    for most users to understand, compared to regular multiselects. It is based on Adrian Rosselli in
    https://adrianroselli.com/2022/05/under-engineered-multi-selects.html which is licensed as CC BY-SA 4.0

    Inputs:
        - label: text label for input group
        - id: container id + name field for the inputs
        - items: list of hashrefs to turn into checkboxes.
        - nowrapper: print without the wrapper span (useful if you want to re-render the contents with AJAX). Defaults to false.

        Each item should have the following keys:
        - name: visually displayed name
        - value: input element value
        - selected: whether the input should be selected (will default to false if this isn't set)
#%]

[% dw.need_res( { group => "foundation" },
        "stc/css/components/checkbox-multiselect.css"
        "js/components/jquery.checkbox-multiselect.js"
) %]

[% "<span id='$id-wrapper' class='checkbox-multiselect-wrapper'>" UNLESS nowrapper %]
[% form.textbox(
    name = "$id-search"
    id = "$id-search"
    class = "multiselect-search no-js"
) %]
[% form.button(
    name = "select-all"
    id = "select-all"
    value = 'Select All'
    class = "no-js button"
) %]
[% form.button(
    name = "selected-only"
    id = "selected-only"
    value = 'Only Show Selected'
    class = "no-js button"
) %]
[% form.button(
    name = "clear-filters"
    id = "clear-filters"
    value = 'Clear Search'
    class = "no-js button"
) %]
<span id="[% id %]_label" class="label">[% label %]</span>
<div role="group" aria-labelledby="[% id %]_label" tabindex="0" id="[% id %]" class="checkbox-multiselect">
    <span class="checkbox-multiselect-item">
      <a href="#[% id %]-multiselect-skip">Skip</a>
    </span>

    [% FOREACH item IN items %]
        <span class="checkbox-multiselect-item input-row">
        [% form.checkbox( 
            name = id 
            value = item.value
            label = item.name
            selected = item.selected 
        ) %]
            </span>
    [% END %]
</div>
<span id="[% id %]-multiselect-skip"></span>
[% "</span>" UNLESS nowrapper %]